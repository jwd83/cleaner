<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>URL Cleaner — Dark</title>
    <style>
      /* Dark minimal styling inspired by tools.jwd.me */
      :root {
        --bg: #121212;
        --card: #1e1e1e;
        --muted: #9a9a9a;
        --accent: #3b82f6;
        --radius: 10px;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono",
          "Segoe UI Mono", monospace;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
        background: var(--bg);
        color: #f5f5f5;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 48px 16px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .wrap {
        width: 100%;
        max-width: 820px;
      }
      header {
        margin-bottom: 18px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 6px 0;
        letter-spacing: -0.01em;
        color: #fff;
      }
      p.lead {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }
      .card {
        background: var(--card);
        border-radius: var(--radius);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
        padding: 18px;
        margin-top: 18px;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      input[type="url"] {
        flex: 1;
        padding: 12px 14px;
        border-radius: 8px;
        border: 1px solid #333;
        background: #111;
        color: #eee;
        font-size: 15px;
        outline: none;
        box-sizing: border-box;
      }
      input[type="url"]:focus {
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        border-color: var(--accent);
      }
      button {
        padding: 10px 14px;
        border-radius: 8px;
        border: 0;
        background: var(--accent);
        color: white;
        font-weight: 600;
        cursor: pointer;
        font-size: 14px;
      }
      button.secondary {
        background: transparent;
        color: var(--muted);
        border: 1px solid #333;
      }
      .output {
        margin-top: 14px;
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .outbox {
        flex: 1;
        background: #111;
        border-radius: 8px;
        padding: 12px 14px;
        font-family: var(--mono);
        font-size: 14px;
        word-break: break-all;
        color: #ddd;
      }
      .meta {
        margin-top: 10px;
        font-size: 13px;
        color: var(--muted);
      }
      .hint {
        font-size: 13px;
        color: var(--muted);
        margin-top: 10px;
      }
      .small {
        font-size: 12px;
        color: #777;
      }
      footer {
        margin-top: 14px;
        font-size: 12px;
        color: var(--muted);
      }
      .ok {
        color: #4ade80;
        font-weight: 700;
      } /* green */
      .err {
        color: #f87171;
        font-weight: 700;
      } /* red */
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>URL Cleaner</h1>
        <p class="lead">
          Paste a URL from Amazon / eBay / YouTube / Newegg / Google — strip
          tracking and copy the clean link.
        </p>
      </header>

      <div class="card" id="app">
        <div class="row">
          <input
            id="inputUrl"
            type="url"
            placeholder="Paste URL here…"
            autocomplete="off"
          />
          <button id="cleanBtn">Clean</button>
          <button id="pasteBtn" class="secondary">Paste</button>
        </div>

        <div class="output">
          <div class="outbox" id="output">No result yet.</div>
          <button id="copyBtn">Copy</button>
        </div>

        <div class="meta" id="meta"></div>
        <div class="hint">
          Supported: Amazon, eBay, YouTube, Newegg, Google Search, Google
          Images.
        </div>
        <footer class="small">Cleaned URL is auto-copied on success.</footer>
      </div>
    </div>

    <script>
      (function () {
        // Helpers
        const $ = (sel) => document.querySelector(sel);
        const input = $("#inputUrl");
        const out = $("#output");
        const meta = $("#meta");
        const cleanBtn = $("#cleanBtn");
        const copyBtn = $("#copyBtn");
        const pasteBtn = $("#pasteBtn");

        function safeDecode(s) {
          try {
            return decodeURIComponent(s.replace(/\+/g, " "));
          } catch (e) {
            return s;
          }
        }

        function setOutput(text, status = "ok") {
          out.textContent = text;
          meta.innerHTML =
            status === "ok"
              ? '<span class="ok">Cleaned & copied to clipboard</span>'
              : '<span class="err">' + status + "</span>";
        }

        async function writeClipboard(text) {
          if (!navigator.clipboard) return false;
          try {
            await navigator.clipboard.writeText(text);
            return true;
          } catch (e) {
            // fallback: select out text and let user copy
            return false;
          }
        }

        function buildUrl(origin, path, paramsObj) {
          const u = new URL("https://example.invalid");
          u.protocol = "https:";
          u.hostname = origin;
          u.pathname = path;
          if (paramsObj) {
            const sp = new URLSearchParams();
            for (const k of Object.keys(paramsObj)) {
              if (paramsObj[k] == null) continue;
              sp.set(k, paramsObj[k]);
            }
            const query = sp.toString();
            if (query) u.search = "?" + query;
            else u.search = "";
          } else {
            u.search = "";
          }
          // return without the fake host if not intended — but we use full forms below
          return u
            .toString()
            .replace("https://example.invalid", "https://" + origin);
        }

        // Cleaning rules
        function cleanAmazon(u) {
          // Support multiple amazon tlds
          // Find ASIN by known patterns: /dp/<ASIN>, /gp/product/<ASIN>, asin=... or last path segment 10-chars
          const asinRe =
            /(?:\/dp\/|\/gp\/product\/|\/gp\/aw\/d\/|\/product\/|[?&]asin=)([A-Za-z0-9]{10})/i;
          const m = u.href.match(asinRe);
          if (m && m[1]) {
            const asin = m[1].toUpperCase();
            return `https://${u.hostname.replace(/^www\./, "")}/dp/${asin}`;
          }
          // fallback: sometimes ASIN is a 10-char token in path
          const pathParts = u.pathname.split("/");
          for (const p of pathParts) {
            if (/^[A-Za-z0-9]{10}$/.test(p))
              return `https://${u.hostname.replace(/^www\./, "")}/dp/${p}`;
          }
          return null;
        }

        function cleanEbay(u) {
          // eBay item ids are long digits in /itm/.../<itemid> or /itm/<itemid>
          let m = u.pathname.match(/\/itm\/(?:.*\/)?(\d{9,15})(?:$|\/|\?)/);
          if (m && m[1])
            return `https://${u.hostname.replace(/^www\./, "")}/itm/${m[1]}`;
          // sometimes in query
          m = u.search.match(/[?&](item|itm)=(\d{9,15})/);
          if (m && m[2])
            return `https://${u.hostname.replace(/^www\./, "")}/itm/${m[2]}`;
          return null;
        }

        function cleanYouTube(u) {
          // v= param or youtu.be short
          // prefer youtube.com/watch?v=ID (canonical) or youtu.be/ID
          const host = u.hostname.toLowerCase();
          // youtu.be short
          if (host === "youtu.be") {
            const id = u.pathname.replace(/^\/+/, "").split(/[/?#]/)[0];
            if (/^[A-Za-z0-9_-]{8,20}$/.test(id))
              return `https://youtu.be/${id}`;
          }
          // youtube.com
          if (
            host.includes("youtube.com") ||
            host.includes("youtube-nocookie.com")
          ) {
            const params = new URLSearchParams(u.search);
            const v = params.get("v");
            if (v) return `https://www.youtube.com/watch?v=${v}`;
            // sometimes /watch/ or /embed/<id>
            let m = u.pathname.match(/\/(embed|v)\/([A-Za-z0-9_-]{8,20})/);
            if (m && m[2]) return `https://www.youtube.com/watch?v=${m[2]}`;
            // shorts
            m = u.pathname.match(/\/shorts\/([A-Za-z0-9_-]{8,20})/);
            if (m && m[1]) return `https://www.youtube.com/watch?v=${m[1]}`;
          }
          return null;
        }

        function cleanNewegg(u) {
          // Many Newegg product pages have Item= or /p/ or Product/...
          // Try query Item
          let m = u.search.match(/[?&]Item=(N82E?[_A-Z0-9-]+)/i);
          if (m && m[1])
            return `https://${u.hostname.replace(/^www\./, "")}/p/${m[1]}`;
          // /p/slug/ID or /p/ID
          m = u.pathname.match(/\/p\/[^/]*\/([^/]+)\/?$/i);
          if (m && m[1])
            return `https://${u.hostname.replace(/^www\./, "")}/p/${m[1]}`;
          // /Product/Product.aspx?Item=...
          m = u.search.match(/[?&]ItemNumber=([A-Za-z0-9-]+)/i);
          if (m && m[1])
            return `https://${u.hostname.replace(/^www\./, "")}/p/${m[1]}`;
          // fallback: last path segment if looks like product id
          const seg = u.pathname.split("/").filter(Boolean).pop();
          if (seg && /[A-Za-z0-9-]{6,}/.test(seg))
            return `https://${u.hostname.replace(/^www\./, "")}/p/${seg}`;
          return null;
        }

        function cleanGoogleSearch(u) {
          // For google search keep only q param
          if (!u.pathname.startsWith("/search")) return null;
          const params = new URLSearchParams(u.search);
          const q = params.get("q");
          if (!q) return null;
          return `https://www.google.com/search?q=${encodeURIComponent(
            safeDecode(q)
          )}`;
        }

        function cleanGoogleImages(u) {
          // For images we want tbm=isch + q
          if (!u.pathname.startsWith("/search")) return null;
          const params = new URLSearchParams(u.search);
          const tbm = params.get("tbm");
          const q = params.get("q");
          if (!q) return null;
          if (tbm && tbm.toLowerCase() === "isch") {
            return `https://www.google.com/search?tbm=isch&q=${encodeURIComponent(
              safeDecode(q)
            )}`;
          }
          // also: images.google.com/search?... treat as images if tbm=isch present
          return null;
        }

        function genericClean(u) {
          // Remove common tracking query params for unknown domains:
          const stripParams = [
            "utm_source",
            "utm_medium",
            "utm_campaign",
            "utm_term",
            "utm_content",
            "gclid",
            "fbclid",
            "mc_eid",
            "mc_cid",
            "ref",
            "ref_src",
            "_hsenc",
            "_hsmi",
            "trk",
            "amp",
            "mkt_tok",
          ];
          const sp = new URLSearchParams(u.search);
          let changed = false;
          for (const p of stripParams)
            if (sp.has(p)) {
              sp.delete(p);
              changed = true;
            }
          if (!changed) return null;
          return (
            u.origin + u.pathname + (sp.toString() ? "?" + sp.toString() : "")
          );
        }

        // Master cleaner
        function clean(urlText) {
          let url;
          try {
            // allow plain urls missing scheme
            if (!/^[a-zA-Z][a-zA-Z\d+\-.]*:\/\//.test(urlText)) {
              urlText = "https://" + urlText;
            }
            url = new URL(urlText);
          } catch (e) {
            return { error: "Invalid URL" };
          }

          const host = url.hostname.toLowerCase();

          // Amazon domains
          if (host.includes("amazon.")) {
            const r = cleanAmazon(url);
            if (r) return { result: r };
            return { error: "Could not find ASIN on Amazon URL" };
          }

          // eBay
          if (host.includes("ebay.")) {
            const r = cleanEbay(url);
            if (r) return { result: r };
            return { error: "Could not find item ID on eBay URL" };
          }

          // YouTube
          if (
            host.includes("youtube.") ||
            host === "youtu.be" ||
            host.includes("youtube-nocookie.")
          ) {
            const r = cleanYouTube(url);
            if (r) return { result: r };
            return { error: "Could not extract video ID from YouTube URL" };
          }

          // Newegg
          if (host.includes("newegg.")) {
            const r = cleanNewegg(url);
            if (r) return { result: r };
            return { error: "Could not find product ID on Newegg URL" };
          }

          // Google search / images (covers google.* hosts)
          if (host.includes("google.")) {
            const rImg = cleanGoogleImages(url);
            if (rImg) return { result: rImg };
            const rSearch = cleanGoogleSearch(url);
            if (rSearch) return { result: rSearch };
            return { error: "Unsupported Google URL or missing query (q=)" };
          }

          // Generic attempt to strip common tracking params
          const generic = genericClean(url);
          if (generic) return { result: generic };

          return { error: "Unsupported domain or nothing to clean" };
        }

        // UI handlers
        async function doCleanAndCopy() {
          const v = input.value.trim();
          if (!v) {
            setOutput("No URL provided", "Provide a URL.");
            return;
          }
          const r = clean(v);
          if (r.error) {
            setOutput(r.error, r.error);
            return;
          }
          const success = await writeClipboard(r.result);
          setOutput(
            r.result,
            success
              ? "ok"
              : "Copied (clipboard API unavailable — please copy manually)."
          );
          // if clipboard API unavailable, try selecting the outbox to help manual copy
          if (!success) {
            selectOutputText();
          }
        }

        function selectOutputText() {
          // make text selectable so user can copy
          const range = document.createRange();
          range.selectNodeContents(out);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        }

        // events
        cleanBtn.addEventListener("click", doCleanAndCopy);
        copyBtn.addEventListener("click", async () => {
          const txt = out.textContent;
          if (!txt || txt === "No result yet.") return;
          const ok = await writeClipboard(txt);
          if (ok)
            meta.innerHTML =
              '<span class="ok">Manually copied to clipboard</span>';
          else {
            meta.innerHTML =
              '<span class="err">Clipboard API unavailable — select and copy</span>';
            selectOutputText();
          }
        });

        pasteBtn.addEventListener("click", async () => {
          try {
            const t = await navigator.clipboard.readText();
            if (t) input.value = t.trim();
          } catch (e) {
            meta.innerHTML =
              '<span class="err">Clipboard read unavailable</span>';
          }
        });

        input.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter") {
            ev.preventDefault();
            doCleanAndCopy();
          }
        });

        // support dropping a plain url onto the input
        input.addEventListener("paste", (ev) => {
          // let default paste happen, then optionally auto-clean? keep simple: do nothing special
        });

        // Make the outbox clickable to copy
        out.addEventListener("click", async () => {
          const txt = out.textContent;
          if (!txt) return;
          const ok = await writeClipboard(txt);
          if (ok) meta.innerHTML = '<span class="ok">Copied</span>';
          else selectOutputText();
        });

        // convenient: allow dropping a URL onto the card
        document.addEventListener("dragover", (e) => e.preventDefault());
        document.addEventListener("drop", (e) => {
          e.preventDefault();
          const data =
            e.dataTransfer.getData("text/plain") ||
            e.dataTransfer.getData("text/uri-list");
          if (data) {
            input.value = data.trim();
            doCleanAndCopy();
          }
        });

        // Initial small demo value (comment out if undesired)
        // input.value = "https://www.amazon.com/Some-Product/dp/B0FFGHMNFR/ref=sr_1_1?utm_source=test";
      })();

      /* same JS cleaning logic as before, unchanged */
    </script>
  </body>
</html>
